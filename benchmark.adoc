= Benchmark

== Benchmark Evaluation Setup

.Create shared Docker network:
[source,bash]
----
docker network create envite
----

.Create monitoring:
[source,bash]
----
docker compose -f docker-compose-monitoring.yaml pull
docker compose -f docker-compose-monitoring.yaml up -d
----

.Build container images:
[source,bash]
----
./gradlew bootBuildImage
----

.Provide read permissions to those files to anyone to allow access within container:
[source,bash]
----
chmod -R g+r,o+r datasource/
chmod -R g+r,o+r news-db/
chmod -R g+r,o+r monitoring/
----

.Create and init databases:
[source,bash]
----
docker compose -f docker-compose-db.yaml pull --ignore-pull-failures
docker compose -f docker-compose-db.yaml up -d
----

.Start applications (default and cache):
[source,bash]
----
docker compose -f docker-compose-application-default.yaml up -d
docker compose -f docker-compose-application-cache.yaml up -d
----

.Start benchmark (default):
[source,bash]
----
docker compose -f docker-compose-benchmark-default.yaml up -d
----

.Start benchmark (cache):
[source,bash]
----
docker compose -f docker-compose-benchmark-cache.yaml up -d
----

Websites:

* Grafana Dashboards: http://localhost:3000/dashboards
* Prometheus Targets: http://localhost:9090/targets

== Benchmark Runs

Configuration:

* 25000 requests in total
* 1s delay after each request

=== 100 Users and 250 Requests Per User

* Without optimization:
** 2023-11-16 22:01:27 to 2023-11-16 22:06:43
*** Benchmark: https://grafana.lecture.codelabs.dev/d/659db77a-2094-4e6a-8e4f-9b48282fea5b/benchmark-evaluation?orgId=1&var-variant=default&tab=query&from=1700168487546&to=1700168803104
*** Technical: https://grafana.lecture.codelabs.dev/d/7V26irrMz/application-technical?orgId=1&from=1700168487000&to=1700168803000
*** Scaphandre: https://grafana.lecture.codelabs.dev/d/GOHnbBO7z/scaphandre?orgId=1&from=1700168487000&to=1700168803000

* With Http client-side cache:
** 2023-11-16 22:12:55 to 2023-11-16 22:17:33
*** Benchmark: https://grafana.lecture.codelabs.dev/d/659db77a-2094-4e6a-8e4f-9b48282fea5b/benchmark-evaluation?orgId=1&var-variant=cache&tab=query&from=1700169175868&to=1700169453299
*** Technical: https://grafana.lecture.codelabs.dev/d/7V26irrMz/application-technical?orgId=1&from=1700169175000&to=1700169453000
*** Scaphandre: https://grafana.lecture.codelabs.dev/d/GOHnbBO7z/scaphandre?orgId=1&from=1700169175000&to=1700169453000

=== 200 Users and 125 Requests Per User

* Without optimization:
** 2023-11-16 22:22:40 to 2023-11-16 22:27:30
*** Benchmark: https://grafana.lecture.codelabs.dev/d/659db77a-2094-4e6a-8e4f-9b48282fea5b/benchmark-evaluation?orgId=1&var-variant=default&tab=query&from=1700169760656&to=1700170050486
*** Technical: https://grafana.lecture.codelabs.dev/d/7V26irrMz/application-technical?orgId=1&from=1700169760000&to=1700170050000
*** Scaphandre: https://grafana.lecture.codelabs.dev/d/GOHnbBO7z/scaphandre?orgId=1&from=1700169760000&to=1700170050000

* With Http client-side cache:
** 2023-11-16 22:30:52 to 2023-11-16 22:33:15
*** Benchmark: https://grafana.lecture.codelabs.dev/d/659db77a-2094-4e6a-8e4f-9b48282fea5b/benchmark-evaluation?orgId=1&var-variant=cache&tab=query&from=1700170252533&to=1700170395099
*** Technical: https://grafana.lecture.codelabs.dev/d/7V26irrMz/application-technical?orgId=1&from=1700170252000&to=1700170395000
*** Scaphandre: https://grafana.lecture.codelabs.dev/d/GOHnbBO7z/scaphandre?orgId=1&from=1700170252000&to=1700170395000

=== 1000 Users and 25 Requests Per User

* Without optimization:
** 2023-11-16 22:37:38 to 2023-11-16 22:42:20
*** Benchmark: https://grafana.lecture.codelabs.dev/d/659db77a-2094-4e6a-8e4f-9b48282fea5b/benchmark-evaluation?orgId=1&var-variant=default&tab=query&from=1700170658914&to=1700170940826
*** Technical: https://grafana.lecture.codelabs.dev/d/7V26irrMz/application-technical?orgId=1&from=1700170658000&to=1700170940000
*** Scaphandre: https://grafana.lecture.codelabs.dev/d/GOHnbBO7z/scaphandre?orgId=1&from=1700170658000&to=1700170940000

* With Http client-side cache:
** 2023-11-16 22:45:19 to 2023-11-16 22:46:05
*** Benchmark: https://grafana.lecture.codelabs.dev/d/659db77a-2094-4e6a-8e4f-9b48282fea5b/benchmark-evaluation?orgId=1&var-variant=cache&tab=query&from=1700171119777&to=1700171165175
*** Technical: https://grafana.lecture.codelabs.dev/d/7V26irrMz/application-technical?orgId=1&from=1700171119000&to=1700171165000
*** Scaphandre: https://grafana.lecture.codelabs.dev/d/GOHnbBO7z/scaphandre?orgId=1&from=1700171100000&to=1700171165000
